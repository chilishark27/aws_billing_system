<!DOCTYPE html>
<html>
<head>
    <title>测试流量费用显示</title>
</head>
<body>
    <h1>流量费用测试</h1>
    
    <div>
        <h3>流量费用: <span id="traffic-cost">加载中...</span></h3>
        <h3>占比: <span id="traffic-percentage">加载中...</span></h3>
    </div>
    
    <button onclick="loadTrafficSummary()">刷新数据</button>
    
    <div id="debug-info"></div>
    
    <script>
    async function loadTrafficSummary() {
        try {
            console.log('开始加载流量费用数据...');
            const response = await fetch('/api/traffic_summary');
            console.log('API响应状态:', response.status);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            console.log('API返回数据:', data);
            
            document.getElementById('traffic-cost').textContent = `$${(data.traffic_cost || 0).toFixed(2)}`;
            document.getElementById('traffic-percentage').textContent = `${(data.traffic_percentage || 0).toFixed(1)}%`;
            
            document.getElementById('debug-info').innerHTML = `
                <h4>调试信息:</h4>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
        } catch (error) {
            console.error('加载失败:', error);
            document.getElementById('traffic-cost').textContent = '$0.00';
            document.getElementById('traffic-percentage').textContent = '0.0%';
            document.getElementById('debug-info').innerHTML = `<p style="color: red;">错误: ${error.message}</p>`;
        }
    }
    
    // 页面加载时自动执行
    document.addEventListener('DOMContentLoaded', loadTrafficSummary);
    </script>
</body>
</html>